{"version":3,"file":"base.js","sourceRoot":"","sources":["../../src/combo/base.ts"],"names":[],"mappings":"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","sourcesContent":["import { clone, deepMix, each, hasKey, isString, mix, isArray } from '@antv/util';\nimport { getScale } from '@antv/scale';\nimport TextDescription from '../components/description';\nimport BBox from '../util/bbox';\nimport Layer, { LayerConfig } from '../base/layer';\nimport ViewLayer from '../base/view-layer';\nimport { isTextUsable } from '../util/common';\nimport ThemeController from '../base/controller/theme';\nimport { ComboViewConfig } from './util/interface';\nimport { DataItem } from '../interface/config';\nimport { getGlobalTheme } from '../theme';\n\nconst LEGEND_MARGIN = 5;\n\nexport interface IComboViewLayer extends ComboViewConfig, LayerConfig {}\n\nexport default abstract class ComboViewLayer<T extends IComboViewLayer = IComboViewLayer> extends Layer<T> {\n  public static getDefaultOptions(): Partial<ComboViewConfig> {\n    return {\n      title: {\n        visible: false,\n        alignTo: 'left',\n        text: '',\n      },\n      description: {\n        visible: false,\n        text: '',\n        alignTo: 'left',\n      },\n    };\n  }\n\n  public initialOptions: T;\n  public title: TextDescription;\n  public description: TextDescription;\n  public viewRange: BBox;\n  public theme: any;\n  public type: string;\n  protected themeController: ThemeController;\n  protected geomLayers: ViewLayer[] = [];\n  protected colors: string[];\n  protected legends: any[] = [];\n  protected requiredField: string[] = ['xField', 'yField'];\n\n  constructor(props: T) {\n    super(props);\n    this.options = this.getOptions(props);\n    this.initialOptions = deepMix({}, props);\n    this.themeController = new ThemeController();\n  }\n\n  public getOptions(props: Partial<T>): T {\n    const curOptions = this.options || {};\n    const options = super.getOptions(props);\n    // @ts-ignore\n    const defaultOptions = this.constructor.getDefaultOptions(props);\n    return deepMix({}, options, defaultOptions, curOptions, props);\n  }\n\n  public checkData() {\n    const { data, xField, yField } = this.options;\n    // 判断1: 没有配置必选字段时不绘制\n    for (let i = 0; i < this.requiredField.length; i++) {\n      const field = this.requiredField[i];\n      if (!hasKey(this.options, field)) {\n        return false;\n      }\n    }\n    // 判断2: yField不是数组或只设置了一个字段时不绘制\n    if (!isArray(yField) || yField.length < 2) {\n      return false;\n    }\n    // 判断3:data为空时不绘制 data:[]\n    if (!isArray(data) || data.length === 0) {\n      return false;\n    }\n    // 判断4: 内嵌两层空数据时不绘制 data:[[],[]]\n    if (data[0]?.length === 0 && data[1]?.length === 0) {\n      return false;\n    }\n    // 判断5：一层数据为空时，利用相关映射字段补齐数据 data:[[],[{type:'a',value:10}]\n    each(data, (d, index) => {\n      if (!isArray(d) || d.length === 0) {\n        const mockData = this.getMockData(index);\n        data[index] = mockData;\n      }\n    });\n    // 判断6: 两份数据xField或值不一致时不绘制\n    if (!data[0][0][xField] || !data[1][0][xField]) {\n      return false;\n    }\n    return true;\n  }\n\n  public init() {\n    super.init();\n    this.theme = this.themeController.getTheme(this.options as any, this.type);\n    this.drawTitle();\n    this.drawDescription();\n  }\n\n  public updateConfig(cfg: Partial<T>) {\n    this.doDestroy();\n    this.options = this.getOptions(cfg);\n    this.processOptions(this.options);\n  }\n\n  public changeData(data: DataItem[][]) {\n    if ((data && data.length < 2) || !isArray(data[0])) {\n      return;\n    }\n    each(this.geomLayers, (layer, index) => {\n      layer.changeData(data[index]);\n    });\n  }\n\n  public changeDataByIndex(data, index) {\n    if (isArray(data[0])) {\n      return;\n    }\n    const geomLayer = this.geomLayers[index];\n    geomLayer.changeData(data);\n  }\n\n  protected doDestroy() {\n    each(this.geomLayers, (layer) => {\n      layer.doDestroy();\n    });\n    this.geomLayers = [];\n    each(this.legends, (legend) => {\n      legend.destroy();\n    });\n    this.legends = [];\n  }\n\n  protected createLayer(LayerCtr, data, config) {\n    const viewRange = this.getViewRange();\n    const layer = new LayerCtr({\n      canvas: this.canvas,\n      container: this.container,\n      x: viewRange.minX,\n      y: viewRange.minY,\n      width: viewRange.width,\n      height: viewRange.height,\n      data,\n      ...config,\n    });\n    this.geomLayers.push(layer);\n    return layer;\n  }\n\n  // 临时修复 v1 双轴图在左侧数据为0的时候右侧scale处理错误的问题\n  protected getLeftYAxisMax() {\n    const leftScaleData = this.getScaleData(0);\n    const rightScaleData = this.getScaleData(1);\n\n    return leftScaleData.min == 0 && leftScaleData.max === 0 ? Math.max(rightScaleData.max, 0) : leftScaleData.max;\n  }\n\n  protected yAxis(index: number) {\n    const leftScaleData = this.getScaleData(0);\n    const { yAxis } = this.options;\n    const config = index === 0 ? yAxis.leftConfig : yAxis.rightConfig;\n    const colorValue = this.colors[index];\n    const yAxisConfig = clone(config);\n    const styleMap = {\n      title: 'stroke',\n      line: 'stroke',\n      label: 'fill',\n      tickLine: 'stroke',\n    };\n    if (config.visible && config.colorMapping) {\n      each(yAxisConfig, (config, name) => {\n        if (!isString(config) && hasKey(styleMap, name)) {\n          const styleKey = styleMap[name];\n          if (!config.style) {\n            config.style = {};\n          }\n          config.style[styleKey] = colorValue;\n        }\n      });\n    }\n    if (!config.visible) {\n      yAxisConfig.title.visible = false;\n      yAxisConfig.tickLine.visible = false;\n      yAxisConfig.label.visible = false;\n      yAxisConfig.line.visible = false;\n      yAxisConfig.visible = true;\n    }\n    const yAxisGlobalConfig = this.getYAxisGlobalConfig();\n\n    if (index === 0 && leftScaleData.max === 0 && leftScaleData.min === 0) {\n      yAxisConfig.max = this.getLeftYAxisMax();\n    }\n\n    return deepMix({}, yAxisGlobalConfig, yAxisConfig);\n  }\n\n  protected getTicks() {\n    const { yAxis } = this.options;\n    const leftScaleData = this.getScaleData(0);\n    // 取到左轴ticks数量\n    const Scale = getScale('linear');\n    const linearScale = new Scale(\n      deepMix(\n        {},\n        {\n          min: 0,\n          max: this.getLeftYAxisMax(),\n          nice: true,\n          values: leftScaleData.values,\n        },\n        {\n          tickCount: yAxis.tickCount,\n        }\n      )\n    );\n    const tickCount = linearScale.ticks.length;\n    // 生成右轴ticks\n    const max = yAxis.max ? linearScale.max : this.getScaleData(1).max;\n    const tickInterval = max / (tickCount - 1);\n    const ticks = [];\n    for (let i = 0; i < tickCount; i++) {\n      let tickValue = i * tickInterval;\n      if (!Number.isInteger(tickValue)) {\n        tickValue = parseFloat(tickValue.toFixed(1));\n      }\n      ticks.push(tickValue);\n    }\n    return ticks;\n  }\n\n  protected getScaleData(index: number) {\n    const { data, yField, yAxis } = this.options;\n    const values = [];\n    each(data[index], (d) => {\n      values.push(d[yField[index]]);\n    });\n    values.sort((a, b) => a - b);\n    const min = values[0];\n    const max = yAxis.max ? yAxis.max : values[values.length - 1];\n    return { min, max, values };\n  }\n\n  protected getDataByXField(value: number | string, index: number) {\n    const { data, xField } = this.options;\n    const dataSource = data[index];\n    return dataSource.filter((d) => {\n      return d[xField] === value;\n    });\n  }\n\n  protected getYAxisGlobalConfig() {\n    const { min, max, tickCount } = this.options.yAxis;\n    return { min, max, tickCount };\n  }\n\n  protected adjustLayout() {\n    const { bleeding } = getGlobalTheme();\n    if (isArray(bleeding)) {\n      each(bleeding, (it, index) => {\n        if (typeof bleeding[index] === 'function') {\n          bleeding[index] = bleeding[index](this.options);\n        }\n      });\n    }\n    const viewRange = this.getViewRange();\n    const leftPadding: number[] = this.transfromPadding(this.geomLayers[0].options.padding);\n    const rightPadding: number[] = this.transfromPadding(this.geomLayers[1].options.padding);\n\n    // 获取legendHeight并加入上部padding\n    let legendHeight = 0;\n    let legendABBox;\n    let legendBBBox;\n    if (this.options.legend?.visible) {\n      legendABBox = this.legends[0].getLayoutBBox();\n      legendBBBox = this.legends[1].getLayoutBBox();\n      legendHeight = legendABBox.height + LEGEND_MARGIN * 2;\n    }\n    // 同步左右padding\n    // const uniquePadding = [leftPadding[0] + legendHeight, rightPadding[1], rightPadding[2], leftPadding[3]];\n    const uniquePadding = leftPadding.map((item: number, index: number) => {\n      // 兼容老版本\n      if (index === 0) {\n        return Math.max.apply(null, [item + legendHeight, rightPadding[index]]);\n      }\n      return Math.max.apply(null, [item, rightPadding[index]]);\n    });\n\n    this.geomLayers[0].updateConfig({\n      padding: uniquePadding,\n    });\n    this.geomLayers[0].render();\n    this.geomLayers[1].updateConfig({\n      padding: uniquePadding,\n    });\n    this.geomLayers[1].render();\n    // 更新legend的位置\n    if (this.options.legend?.visible) {\n      this.legends[0].setLocation({\n        x: bleeding[3],\n        y: viewRange.minY + LEGEND_MARGIN,\n      });\n      this.legends[1].setLocation({\n        x: viewRange.maxX - bleeding[1] - legendBBBox.width,\n        y: viewRange.minY + LEGEND_MARGIN,\n      });\n    }\n  }\n\n  /**\n   * padding 预处理\n   * @param {string | number | number[]} padding\n   */\n  private transfromPadding(padding: string | number | number[]): number[] {\n    if (typeof padding === 'string' || typeof padding === 'number') {\n      return [Number(padding)];\n    }\n    return padding;\n  }\n\n  protected legendFilter(index) {\n    const legend = this.legends[index];\n    const legend_group = legend.get('group');\n    legend_group.on('click', () => {\n      const item = legend.get('items')[0];\n      if (!item.unchecked) {\n        legend.setItemState(item, 'unchecked', true);\n        this.hideLayer(index);\n      } else {\n        legend.setItemState(item, 'unchecked', false);\n        this.showLayer(index);\n      }\n    });\n  }\n\n  protected hideLayer(index) {\n    const layer = this.geomLayers[index];\n    const field = this.options.yField[index];\n    // 隐藏layer时只隐藏yAxis和geometry\n    const { view } = layer;\n    const axisContainer = this.getYAxisContainer(view, field);\n    if (axisContainer) {\n      axisContainer.set('visible', false);\n    }\n    this.setGeometryVisibility(view, false);\n    this.canvas.draw();\n  }\n\n  protected showLayer(index) {\n    const layer = this.geomLayers[index];\n    const field = this.options.yField[index];\n    const { view } = layer;\n    const axisContainer = this.getYAxisContainer(view, field);\n    if (axisContainer) {\n      axisContainer.set('visible', true);\n    }\n    this.setGeometryVisibility(view, true);\n    this.canvas.draw();\n  }\n\n  protected setGeometryVisibility(view, show) {\n    each(view.geometries, (geom) => {\n      const { container, labelsContainer } = geom;\n      if (container) {\n        container.set('visible', show);\n      }\n      if (labelsContainer) {\n        labelsContainer.set('visible', show);\n      }\n    });\n  }\n\n  protected getYAxisContainer(view, field) {\n    let container;\n    const axisCtr = view.controllers.filter((ctr) => {\n      return hasKey(ctr, 'axisContainer');\n    })[0];\n    if (axisCtr) {\n      const ctr = axisCtr as any;\n      const axisGroups = ctr.axisContainer.get('children');\n      each(axisGroups, (g) => {\n        const axisField = g.get('component').get('field');\n        if (axisField === field) {\n          container = g;\n        }\n      });\n    }\n    return container;\n  }\n\n  protected getUnCheckedValue() {\n    const value = [];\n    each(this.legends, (legend) => {\n      const uncheckedItems = legend.getItemsByState('unchecked');\n      each(uncheckedItems, (item) => {\n        value.push(item.name);\n      });\n    });\n    return value;\n  }\n\n  protected drawTitle(): void {\n    const props = this.options;\n    const range = this.layerBBox;\n    if (this.title) {\n      this.title.destroy();\n      this.title = null;\n    }\n\n    if (isTextUsable(props.title)) {\n      const width = this.width;\n      const theme = this.theme;\n      const title = new TextDescription({\n        leftMargin: range.minX + theme.title.padding[3],\n        rightMargin: range.maxX - theme.title.padding[1],\n        topMargin: range.minY + theme.title.padding[0],\n        text: props.title.text,\n        style: mix(theme.title, props.title.style),\n        wrapperWidth: width - theme.title.padding[3] - theme.title.padding[1],\n        container: this.container.addGroup() as any,\n        theme,\n        index: isTextUsable(props.description) ? 0 : 1,\n        plot: this as any,\n        alignTo: props.title.alignTo,\n        name: 'title',\n      });\n      this.title = title;\n    }\n  }\n\n  protected drawDescription(): void {\n    const props = this.options;\n    const range = this.layerBBox;\n    if (this.description) {\n      this.description.destroy();\n      this.description = null;\n    }\n\n    if (isTextUsable(props.description)) {\n      const width = this.width;\n      const theme = this.theme;\n      let topMargin = 0;\n\n      if (this.title) {\n        const titleBBox = this.title.getBBox();\n        topMargin += titleBBox.minY + titleBBox.height;\n        topMargin += theme.description.padding[0];\n      } else {\n        // 无title的情况下使用title的上padding\n        topMargin += range.minY + theme.title.padding[0];\n      }\n\n      const description = new TextDescription({\n        leftMargin: range.minX + theme.description.padding[3],\n        topMargin,\n        rightMargin: range.maxX - theme.title.padding[1],\n        text: props.description.text,\n        style: mix(theme.description, props.description.style),\n        wrapperWidth: width - theme.description.padding[3] - theme.description.padding[1],\n        container: this.container.addGroup() as any,\n        theme,\n        index: 1,\n        plot: this as any,\n        alignTo: props.description.alignTo,\n        name: 'description',\n      });\n      this.description = description;\n    }\n  }\n\n  protected getViewRange() {\n    if (!this.layerBBox) {\n      this.layerBBox = new BBox(this.x, this.y, this.width, this.height);\n    }\n    let viewMinX = this.layerBBox.minX;\n    let viewMaxX = this.layerBBox.maxX;\n    let viewMinY = this.layerBBox.minY;\n    let viewMaxY = this.layerBBox.maxY;\n    const components = [this.title, this.description];\n\n    each(components, (component) => {\n      if (component) {\n        const { position } = component;\n        const { minX, maxX, minY, maxY } = component.getBBox();\n        if (maxY >= viewMinY && maxY <= viewMaxY && position === 'top') {\n          viewMinY = maxY;\n        }\n        if (minY >= viewMinY && minY <= viewMaxY && position === 'bottom') {\n          viewMaxY = minY;\n        }\n        if (maxX > viewMinX && maxX <= viewMaxX && position === 'left') {\n          viewMinX = maxX;\n        }\n        if (minX >= viewMinX && maxX <= viewMaxX && position === 'right') {\n          viewMaxX = minX;\n        }\n      }\n    });\n    return new BBox(viewMinX, viewMinY, viewMaxX - viewMinX, viewMaxY - viewMinY);\n  }\n\n  protected getMockData(index: number) {\n    const { xField, yField } = this.options as any;\n    const mock = {};\n    mock[xField] = 'null';\n    mock[yField[index]] = 0;\n    return [mock];\n  }\n}\n"]}