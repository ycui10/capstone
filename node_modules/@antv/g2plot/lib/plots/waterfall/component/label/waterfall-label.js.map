{"version":3,"file":"waterfall-label.js","sourceRoot":"","sources":["../../../../../src/plots/waterfall/component/label/waterfall-label.ts"],"names":[],"mappings":";;;AAAA;;;GAGG;AACH,mCAAqC;AAErC,kFAA0D;AAE1D,qCAAuD;AACvD,0DAA2E;AAC3E,qDAA+D;AAE/D,IAAM,MAAM,GAAG,CAAC,CAAC;AAEjB;IAA4C,0CAAW;IAAvD;;IAsCA,CAAC;IArCW,oCAAW,GAArB,UAAsB,KAAa,EAAE,OAAgB;;;QAC3C,IAAA,KAAK,GAAK,OAAO,MAAZ,CAAa;QAC1B,IAAM,QAAQ,GAAG,KAAK,CAAC,OAAO,EAAE,CAAC;QACjC,IAAM,IAAI,GAAG,OAAO,CAAC,OAAO,EAAE,CAAC;QAC/B,IAAM,MAAM,GAAG,IAAI,CAAC,mBAAW,CAAC,CAAC;QACjC,IAAM,IAAI,GAAG,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC;QAC7C,IAAM,KAAK,GAAG,cAAO,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC;QAC3C,IAAA,SAAS,GAAK,IAAI,CAAC,OAAO,UAAjB,CAAkB;QACnC,IAAM,WAAW,GAAmB,EAAE,CAAC,MAAM,CAAC,OAAO,CAAC,QAAQ,EAAE,CAAC,WAAW,CAAC,CAAC;QAC9E,IAAM,YAAY,GAAG,SAAS,CAAC,CAAC,CAAC,WAAW,CAAC,CAAC,CAAC,IAAI,WAAW,CAAC,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC,mBAAW,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;QAC9F,IAAM,cAAc,GAAG,SAAS;YAC9B,CAAC,CAAC,SAAS,CACP,KAAK;gBAEH,GAAC,oBAAO,UAAG,WAAW,CAAC,CAAC,CAAC,0CAAE,OAAO;gBAClC,eAAY,GAAE,WAAW,CAAC,CAAC,CAAC;gBAC5B,oBAAiB,GAAE,CAAC;gBACpB,UAAO,UAAA;gBACP,eAAY,eAAA;qBAEd,YAAY,CACb;YACH,CAAC,CAAC,KAAK,CAAC;QACV,IAAI,IAAI,GAAG,CAAC,QAAQ,CAAC,IAAI,GAAG,QAAQ,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;QAC/C,IAAI,YAAY,GAAG,QAAQ,CAAC;QAE5B,IAAI,IAAI,GAAG,CAAC,EAAE;YACZ,IAAI,GAAG,QAAQ,CAAC,IAAI,GAAG,MAAM,CAAC;YAC9B,YAAY,GAAG,KAAK,CAAC;SACtB;aAAM;YACL,IAAI,GAAG,QAAQ,CAAC,IAAI,GAAG,MAAM,CAAC;SAC/B;QAED,KAAK,CAAC,IAAI,CAAC,GAAG,EAAE,IAAI,CAAC,CAAC;QACtB,KAAK,CAAC,IAAI,CAAC,MAAM,EAAE,cAAc,CAAC,CAAC;QACnC,KAAK,CAAC,IAAI,CAAC,cAAc,EAAE,YAAY,CAAC,CAAC;IAC3C,CAAC;IACH,qBAAC;AAAD,CAAC,AAtCD,CAA4C,eAAW,GAsCtD;;AAED,6BAAsB,CAAC,WAAW,EAAE,cAAc,CAAC,CAAC","sourcesContent":["/**\n * Create By Bruce Too\n * On 2020-02-18\n */\nimport { isArray } from '@antv/util';\n\nimport ColumnLabel from '../../../column/component/label';\nimport { IShape, Element } from '../../../../dependents';\nimport { VALUE_FIELD, INDEX_FIELD } from '../../layer';\nimport { registerLabelComponent } from '../../../../components/label/base';\nimport { MappingDatum, _ORIGIN } from '../../../../dependents';\n\nconst MARGIN = 2;\n\nexport default class WaterfallLabel extends ColumnLabel {\n  protected adjustLabel(label: IShape, element: Element): void {\n    const { shape } = element;\n    const shapeBox = shape.getBBox();\n    const data = element.getData();\n    const values = data[VALUE_FIELD];\n    const diff = data[this.layer.options.yField];\n    const value = isArray(values) ? values[1] : values;\n    const { formatter } = this.options;\n    const mappingData: MappingDatum[] = [].concat(element.getModel().mappingData);\n    const elementIndex = formatter ? mappingData[0] && mappingData[0]['_origin'][INDEX_FIELD] : 0;\n    const formatterValue = formatter\n      ? formatter(\n          value,\n          {\n            [_ORIGIN]: mappingData[0]?._origin,\n            mappingDatum: mappingData[0],\n            mappingDatumIndex: 0,\n            element,\n            elementIndex,\n          },\n          elementIndex\n        )\n      : value;\n    let yPos = (shapeBox.minY + shapeBox.maxY) / 2;\n    let textBaseline = 'bottom';\n\n    if (diff < 0) {\n      yPos = shapeBox.maxY + MARGIN;\n      textBaseline = 'top';\n    } else {\n      yPos = shapeBox.minY - MARGIN;\n    }\n\n    label.attr('y', yPos);\n    label.attr('text', formatterValue);\n    label.attr('textBaseline', textBaseline);\n  }\n}\n\nregisterLabelComponent('waterfall', WaterfallLabel);\n"]}